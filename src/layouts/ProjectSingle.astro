---
import ShowcaseCard from "@/components/ShowcaseCard.astro";
import Share from "@/components/Share.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import dateFormat from "@/lib/utils/dateFormat";
import similarItems from "@/lib/utils/similarItems";
import { humanize, markdownify } from "@/lib/utils/textConverter";
import { render } from "astro:content";
import { FaRegClock, FaRegFolder, FaRegUserCircle } from "react-icons/fa";
import ImageMod from "./components/ImageMod.astro";

const COLLECTION_FOLDER = "projects";
const { post } = Astro.props;

const posts = await getSinglePage(COLLECTION_FOLDER);
const similarProjects = similarItems(post, posts);
const { Content } = await render(post);
const {
  title,
  description,
  author,
  categories = [],
  image,
  date,
  tags = [],
} = post.data;
---

<section class="section pt-7">
  <div class="container">
    <div class="row justify-center">
      <article class="lg:col-10">
        {
          image && (
            <div class="mb-10">
              <ImageMod
                alt={title}
                class="w-full rounded"
                format="webp"
                height={500}
                src={image}
                width={1200}
              />
            </div>
          )
        }
        <h1
          class="h2 mb-4"
          set:html={markdownify(title)}
        />
        <ul class="mb-4">
          <li class="mr-4 inline-block">
            <FaRegUserCircle className={"mr-2 -mt-1 inline-block"} />
            {humanize(author)}
          </li>
          {
            categories.length > 0 && (
              <li class="mr-4 inline-block">
                <FaRegFolder className={"mr-2 -mt-1 inline-block"} />
                {categories.map((category: string, index: number) => (
                  <span>
                    {humanize(category)}
                    {index !== categories.length - 1 && ","}
                  </span>
                ))}
              </li>
            )
          }
          {
            date && (
              <li class="mr-4 inline-block">
                <FaRegClock className={"mr-2 -mt-1 inline-block"} />
                {dateFormat(date)}
              </li>
            )
          }
        </ul>
        <div class="content mb-10">
          <Content />
        </div>
        <div class="row items-start justify-between">
          {
            tags.length > 0 && (
              <div class="mb-10 flex items-center lg:col-5 lg:mb-0">
                <h5 class="mr-3">ป้ายกำกับ :</h5>
                <ul>
                  {tags.map((tag: string) => (
                    <li class="inline-block">
                      <span class="m-1 block rounded bg-light px-3 py-1 dark:bg-darkmode-light">
                        {humanize(tag)}
                      </span>
                    </li>
                  ))}
                </ul>
              </div>
            )
          }
          <div class="flex items-center lg:col-4">
            <h5 class="mr-3">แชร์ :</h5>
            <Share
              className="social-icons"
              description={description}
              slug={`${COLLECTION_FOLDER}/${post.id}`}
              title={title}
            />
          </div>
        </div>
      </article>
    </div>

    {
      similarProjects.length > 0 && (
        <div class="section pb-0">
          <h2 class="h3 mb-12 text-center">ผลงานที่เกี่ยวข้อง</h2>
          <div class="row justify-center">
            {similarProjects.map((project) => (
              <div class="mb-14 md:col-6 lg:col-4">
                <ShowcaseCard data={project} />
              </div>
            ))}
          </div>
        </div>
      )
    }
  </div>
</section>
